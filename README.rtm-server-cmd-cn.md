# FPNN RTM SERVER CMD LIST #
[English Version](README.md)

## 一、介绍 ##
* 本文档详细描述RTM服务端函数接口，熟悉FPNN协议的可以直接使用。
* 接口返回错误请见: fpnn-error-code, rtm-error-code

## 二、签名算法规则 ##
* 1，通过后台访问RTM系统，每次访问均需要一个签名
* 2，签名规则：
* 3，所有参与签名的变量均需要转变成utf-8编码，保证不同平台，大小端，编码统一
* 4，salt是一个64位随机整数
* 5，sign=toUpper(md5(tostring(pid)+":"+secret_key+":"+tostring(salt)))
* 6，所有接口均需如下三个参数：
| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| pid | 32位整数 | 必选 | 项目ID |
| salt | 64位整数 | 必选 | 随机数 |
| sign | 字符串 | 必选 | 签名 |


## 三、服务端接口详情 ##

### 1. 发送文本消息 ###
#### (1) sendmsg ####
说明：发送P2P消息

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| from | 64位整数 | 必选 | 发送消息的用户ID |
| to | 64位整数 | 必选 | 接收消息的用户ID |
| mid | 64位整数 | 必选 | 消息的唯一标识，需保证在当前会话中唯一 |
| mtype | 8位整数 | 必选 | 业务方使用，可以作为区分不同业务的标识，配合服务端，根据不同mtype做具体的动作 |
| msg | 字符串 | 必选 | 消息内容 |
| attrs | 字符串 | 必选 | 消息附加属性，建议使用json格式 |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| 无 |  |  成功返回空消息，否则返回错误消息及错误码 |

#### (2) sendmsgs ####
说明：给多个人发送消息

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| from | 64位整数 | 必选 | 发送消息的用户ID |
| tos | 64位整数数组 | 必选 | 接收消息的用户ID列表 |
| mid | 64位整数 | 必选 | 消息的唯一标识，需保证在当前会话中唯一 |
| mtype | 8位整数 | 必选 | 业务方使用，可以作为区分不同业务的标识，配合服务端，根据不同mtype做具体的动作 |
| msg | 字符串 | 必选 | 消息内容 |
| attrs | 字符串 | 必选 | 消息附加属性，建议使用json格式 |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| 无 |  |  成功返回空消息，否则返回错误消息及错误码 |

#### (3) sendgroupmsg ####
说明：给一个组发送消息，用户必须在当前组

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| from | 64位整数 | 必选 | 发送消息的用户ID |
| gid | 64位整数 | 必选 | 接收消息的组ID |
| mid | 64位整数 | 必选 | 消息的唯一标识，需保证在当前会话中唯一 |
| mtype | 8位整数 | 必选 | 业务方使用，可以作为区分不同业务的标识，配合服务端，根据不同mtype做具体的动作 |
| msg | 字符串 | 必选 | 消息内容 |
| attrs | 字符串 | 必选 | 消息附加属性，建议使用json格式 |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| 无 |  |  成功返回空消息，否则返回错误消息及错误码 |

#### (4) sendroommsg ####
说明：给一个房间发送消息，用户必须在当前房间

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| from | 64位整数 | 必选 | 发送消息的用户ID |
| rid | 64位整数 | 必选 | 接收消息的房间ID |
| mid | 64位整数 | 必选 | 消息的唯一标识，需保证在当前会话中唯一 |
| mtype | 8位整数 | 必选 | 业务方使用，可以作为区分不同业务的标识，配合服务端，根据不同mtype做具体的动作 |
| msg | 字符串 | 必选 | 消息内容 |
| attrs | 字符串 | 必选 | 消息附加属性，建议使用json格式 |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| 无 |  |  成功返回空消息，否则返回错误消息及错误码 |

#### (5) broadcastmsg ####
说明：以from的名义 整个项目发送消息，from必须是admin id

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| from | 64位整数 | 必选 | 发送消息的用户ID |
| mid | 64位整数 | 必选 | 消息的唯一标识，需保证在当前会话中唯一 |
| mtype | 8位整数 | 必选 | 业务方使用，可以作为区分不同业务的标识，配合服务端，根据不同mtype做具体的动作 |
| msg | 字符串 | 必选 | 消息内容 |
| attrs | 字符串 | 必选 | 消息附加属性，建议使用json格式 |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| 无 |  |  成功返回空消息，否则返回错误消息及错误码 |


### 2. 发送文件相关 ###
#### (1) filetoken ####
说明：获取文件服务器的地址及鉴权信息

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| from | 64位整数 | 必选 | 发送消息的用户ID |
| cmd | 字符串 | 必选 | 需要调用的发送文件接口，只能是如下4个接口之一：sendfile，sendfiles，sendroomfile，sendgroupfile |
| to | 64位整数 | 可选 | cmd=sendfile 时必须指定此值 |
| tos | 64位整数数组 | 可选 | cmd=sendfiles 时必须指定此值 |
| rid | 64位整数 | 可选 | cmd=sendroomfile 时必须指定此值 |
| gid | 64位整数 | 可选 | cmd=sendgroupfile 时必须指定此值 |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| token | 字符串 |  发送文件时鉴权使用，一次有效 |
| endpoint | 字符串 |  文件服务器地址，格式：IP:port |

#### (2) sendfile ####
说明：发送P2P文件

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| pid | 32位整数 | 必选 | 项目ID |
| from | 64位整数 | 必选 | 发送文件的用户ID |
| to | 64位整数 | 必选 | 接收文件的用户ID |
| token | 字符串 | 必选 | filetoken接口返回的字符串token |
| mid | 64位整数 | 必选 | 消息的唯一标识，需保证在当前会话中唯一 |
| mtype | 8位整数 | 必选 | 业务方使用，可以作为区分不同业务的标识，配合服务端，根据不同mtype做具体的动作 |
| file | 字符串 | 必选 | 文件内容 |
| attrs | 字符串 | 必选 | 文件附加属性，必须使用json格式，必须包含两项：ext：后缀名，sign：校验码 |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| 无 |  |  成功返回空消息，否则返回错误消息及错误码 |

#### (3) sendfiles ####
说明：给多个人发送文件

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| pid | 32位整数 | 必选 | 项目ID |
| from | 64位整数 | 必选 | 发送文件的用户ID |
| tos | 64位整数数组 | 必选 | 接收文件的用户ID列表 |
| token | 字符串 | 必选 | filetoken接口返回的字符串token |
| mid | 64位整数 | 必选 | 消息的唯一标识，需保证在当前会话中唯一 |
| mtype | 8位整数 | 必选 | 业务方使用，可以作为区分不同业务的标识，配合服务端，根据不同mtype做具体的动作 |
| file | 字符串 | 必选 | 文件内容 |
| attrs | 字符串 | 必选 | 文件附加属性，必须使用json格式，必须包含两项：ext：后缀名，sign：校验码 |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| 无 |  |  成功返回空消息，否则返回错误消息及错误码 |

#### (3) sendgroupfile ####
说明：给一个组发送文件，用户必须在当前组

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| pid | 32位整数 | 必选 | 项目ID |
| from | 64位整数 | 必选 | 发送文件的用户ID |
| gid | 64位整数 | 必选 | 接收文件的组ID |
| token | 字符串 | 必选 | filetoken接口返回的字符串token |
| mid | 64位整数 | 必选 | 消息的唯一标识，需保证在当前会话中唯一 |
| mtype | 8位整数 | 必选 | 业务方使用，可以作为区分不同业务的标识，配合服务端，根据不同mtype做具体的动作 |
| file | 字符串 | 必选 | 文件内容 |
| attrs | 字符串 | 必选 | 文件附加属性，必须使用json格式，必须包含两项：ext：后缀名，sign：校验码 |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| 无 |  |  成功返回空消息，否则返回错误消息及错误码 |

#### (4) sendroomfile ####
说明：给一个房间发送文件，用户必须在当前房间

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| pid | 32位整数 | 必选 | 项目ID |
| from | 64位整数 | 必选 | 发送文件的用户ID |
| rid | 64位整数 | 必选 | 接收文件的房间ID |
| token | 字符串 | 必选 | filetoken接口返回的字符串token |
| mid | 64位整数 | 必选 | 消息的唯一标识，需保证在当前会话中唯一 |
| mtype | 8位整数 | 必选 | 业务方使用，可以作为区分不同业务的标识，配合服务端，根据不同mtype做具体的动作 |
| file | 字符串 | 必选 | 文件内容 |
| attrs | 字符串 | 必选 | 文件附加属性，必须使用json格式，必须包含两项：ext：后缀名，sign：校验码 |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| 无 |  |  成功返回空消息，否则返回错误消息及错误码 |


### 3. 用户个性化操作 ###
#### (1) setpushname ####
说明：设置在推送的时候使用的用户名

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| uid | 64位整数 | 必选 | 用户ID |
| pushname | 字符串 | 必选 | 推送名字 |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| 无 |  |  成功返回空消息，否则返回错误消息及错误码 |

#### (2) getpushname ####
说明：获取在推送的时候使用的用户名

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| uid | 64位整数 | 必选 | 用户ID |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| pushname | 字符串 | 推送名字  |

#### (3) setgeo ####
说明：设置用户的经纬度

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| uid | 64位整数 | 必选 | 用户ID |
| lat | 浮点型 | 必须 | 经度 |
| lng | 浮点型 | 必须 | 纬度 |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| 无 |  | 成功返回空消息，否则返回错误消息及错误码  |

#### (4) getgeo ####
说明：获取用户的经纬度

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| uid | 64位整数 | 必选 | 用户ID |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| lat | 浮点型 |  经度 |
| lng | 浮点型 |  纬度 |

#### (5) getgeos ####
说明：获取用户的经纬度

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| uids | 64位整数数组 | 必须 | 需要获取的用户ID列表，每次最多10人 |

返回如下结构的列表：

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| uid | 字符串 |  用户id |
| lat | 字符串 |  经度 |
| lng | 字符串 |  纬度 |


### 4. 好友操作 ###
#### (1) addfriends ####
说明：添加好友，RTM系统的好友只是业务系统的一个镜像

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| uid | 64位整数 | 必选 | 用户ID |
| friends | 64位整数数组 | 必选 | 需要添加的好友，每次最多100人 |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| 无 |  |  成功返回空消息，否则返回错误消息及错误码 |

#### (2) delfriends ####
说明：删除好友

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| uid | 64位整数 | 必选 | 用户ID |
| friends | 64位整数数组 | 必选 | 需要删除的好友，每次最多100人 |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| 无 |  |  成功返回空消息，否则返回错误消息及错误码 |

#### (3) getfriends ####
说明：获取好友列表

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| uid | 64位整数 | 必选 | 用户ID |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| uids | 64位整数数组 |  好友列表 |

#### (4) isfriend ####
说明：判断好友关系

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| uid | 64位整数 | 必选 | 用户ID |
| fuid | 64位整数 | 必选 | 好友ID |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| ok | 布尔值 |  ok=true：是好友，ok=false：不是好友 |

#### (5) isfriends ####
说明：判断多人间的好友关系

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| uid | 64位整数 | 必选 | 用户ID |
| fuids | 64位整数数组 | 必选 | 好友ID列表，每次最多100人 |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| fuids | 64位整数数组 |  返回和uid用户是好友的用户列表 |


### 5. 群组操作 ###
#### (1) addgroupmembers ####
说明：添加组成员，当前用户必须在组内，管理员则不限制，RTM系统的组关系只是业务系统的一个镜像

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| gid | 64位整数 | 必选 | 组ID |
| uids | 64位整数数组 | 必选 | 需要添加的组成员，每次最多100人 |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| 无 |  |  成功返回空消息，否则返回错误消息及错误码 |

#### (2) delgroupmembers ####
说明：删除组成员，当前用户必须在组内，管理员则不限制

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| gid | 64位整数 | 必选 | 组ID |
| uids | 64位整数数组 | 必选 | 需要添加的组成员，每次最多100人 |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| 无 |  |  成功返回空消息，否则返回错误消息及错误码 |

#### (3) delgroup ####
说明：删除组，当前用户必须在组内，管理员则不限制

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| gid | 64位整数 | 必选 | 组ID |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| 无 |  |  成功返回空消息，否则返回错误消息及错误码 |

#### (4) getgroupmembers ####
说明：获取组中所有成员，当前用户必须在组内

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| gid | 64位整数 | 必选 | 组ID |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| uids | 64位整数数组 | 组成员列表 |

#### (5) getusergroups ####
说明：获取当前用户在哪些组内

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| uid | 64位整数 | 必选 | 用户ID |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| gids | 64位整数数组 | 组列表 |

#### (6) isgroupmember ####
说明：是否是组用户成员

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| gid | 64位整数 | 必选 | 组ID |
| uid | 64位整数 | 必选 | 用户ID |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| ok | 布尔值 | ok=true: 是，ok=false：不是 |

### 6. 获取Token操作 ###
#### (1) gettoken ####
说明：获取token

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| uid | 64位整数 | 必选 | 用户ID |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| token | 字符串 |  用户身份标示，可以用此token登录RTM系统 |


### 7. 获取在线用户作 ###
#### (1) getonlineusers ####
说明：获取在线用户，每次最多获取200人

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| uids | 64位整数数组 | 必选 | 需要获取的在线用户 |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| uids | 64位整数数组 |  在线用户列表 |


### 8. 权限操作 ###
#### (1) addgroupban ####
说明：添加对组禁言，当前用户禁止对组收发消息，禁言时长有btime确定，从当前时间开始，以秒计算

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| gid | 64位整数 | 必选 | 组ID |
| uid | 64位整数 | 必选 | 用户ID |
| btime | 32位整数 | 必选 | 禁言时长，以秒计算，btime<=0 则永久禁言 |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| 无 |  |  成功返回空消息，否则返回错误消息及错误码 |

#### (2) removegroupban ####
说明：解除组禁言，当前用户可以对组收发消息

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| gid | 64位整数 | 必选 | 组ID |
| uid | 64位整数 | 必选 | 用户ID |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| 无 |  |  成功返回空消息，否则返回错误消息及错误码 |

#### (3) addroomban ####
说明：添加对房间禁言，用户禁止对房间收发消息，禁言时长有btime确定，从当前时间开始，以秒计算

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| rid | 64位整数 | 必选 | 房间ID |
| uid | 64位整数 | 必选 | 用户ID |
| btime | 32位整数 | 必选 | 禁言时长，以秒计算，btime<=0 则永久禁言 |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| 无 |  |  成功返回空消息，否则返回错误消息及错误码 |

#### (4) removeroomban ####
说明：解除房间禁言，当前可以对房间收发消息

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| rid | 64位整数 | 必选 | 房间ID |
| uid | 64位整数 | 必选 | 用户ID |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| 无 |  |  成功返回空消息，否则返回错误消息及错误码 |

#### (5) addprojectblack ####
说明：加入项目黑名单，用不能登录RTM，如果已经登录，直接踢出，时长有btime确定，从当前时间开始，以秒计算

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| uid | 64位整数 | 必选 | 用户ID |
| btime | 32位整数 | 必选 | 禁言时长，以秒计算，btime<=0 则永久禁言 |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| 无 |  |  成功返回空消息，否则返回错误消息及错误码 |

#### (6) removeprojectblack ####
说明：解除黑名单

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| uid | 64位整数 | 必选 | 用户ID |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| 无 |  |  成功返回空消息，否则返回错误消息及错误码 |

#### (7) isbanofgroup ####
说明：检查是否在组中禁言

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| gid | 64位整数 | 必选 | 组ID |
| uid | 64位整数 | 必选 | 用户ID |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| ok | 布尔值 |  ok=true，禁言，ok=false，正常 |

#### (8) isbanofroom ####
说明：检查是否在房间中禁言

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| rid | 64位整数 | 必选 | 房间ID |
| uid | 64位整数 | 必选 | 用户ID |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| ok | 布尔值 |  ok=true，禁言，ok=false，正常 |

#### (9) isprojectblack ####
说明：检查是否在黑名单中

| 输入参数 | 类型 | 必要性 | 描述 |
|------|-------|-----|------|
| uid | 64位整数 | 必选 | 用户ID |

| 输出参数 | 类型 | 描述 |
|------|-------|------|
| ok | 布尔值 |  ok=true，黑名单用户，ok=false，正常 |

